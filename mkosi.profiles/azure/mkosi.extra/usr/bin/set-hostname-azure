#!/bin/bash
set -e

hostname=$(curl -H Metadata:true --fail --silent --show-error \
  --retry 100 --retry-delay 1 --retry-all-errors \
  "http://169.254.169.254/metadata/instance/compute/name?api-version=2025-04-07&format=text")
echo "Setting hostname to '${hostname}'..."
hostname "${hostname}"
echo "127.0.0.1 ${hostname}" >> /etc/hosts
