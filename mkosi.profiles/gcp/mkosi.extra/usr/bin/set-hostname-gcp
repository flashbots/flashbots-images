#!/bin/bash
set -e

hostname=$(curl --header "Metadata-Flavor: Google" --fail --silent --show-error \
  --retry 100 --retry-delay 1 --retry-all-errors \
  http://169.254.169.254/computeMetadata/v1/instance/name)
echo "Setting hostname to '${hostname}'..."
hostname "${hostname}"
echo "127.0.0.1 ${hostname}" >> /etc/hosts
